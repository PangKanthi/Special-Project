import prisma from '../config/db.js';

export const getNotifications = async (req, res) => {
    try {
        const isAdmin = req.user.role === 'A';

        const notifications = await prisma.notification.findMany({
            where: isAdmin ? {} : { userId: req.user.id }, // üëà ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            orderBy: { createdAt: 'desc' }
        });

        res.json(notifications);
    } catch (error) {
        res.status(500).json({ error: "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ" });
    }
};

export const markNotificationAsRead = async (req, res) => {
    try {
        await prisma.notification.update({
            where: { id: Number(req.params.id) },
            data: { isRead: true }
        });
        res.json({ message: "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß" });
    } catch (error) {
        console.error("‚ùå Error updating notification:", error);
        res.status(500).json({ error: "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ" });
    }
};
